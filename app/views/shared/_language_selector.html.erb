<div
  class="space-y-3 sm:flex sm:items-end sm:gap-4 sm:space-y-0"
  data-controller="language-swap"
>

  <%= hidden_field_tag source_field,
        source_language.code,
        data: { language_swap_target: "sourceInput" } %>

  <%= hidden_field_tag target_field,
        target_language.code,
        data: { language_swap_target: "targetInput" } %>

  <!-- SOURCE DROPDOWN -->
  <div class="relative order-1 sm:flex-1">
    <label class="mb-1 block text-xs font-medium uppercase tracking-wide text-slate-700">
      From
    </label>

    <button
      type="button"
      aria-haspopup="listbox"
      aria-expanded="false"
      class="flex w-full items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-2 text-left text-sm shadow-sm text-slate-900
             hover:border-slate-300 focus:outline-none focus:ring-1 focus:ring-sky-500/20 focus:border-sky-500 cursor-pointer"
      data-language-swap-target="sourceLabel"
      data-action="click->language-swap#toggleSourceMenu"
    >
      <span class="truncate" dir="auto"><%= source_language.name %></span>
      <span class="ml-2 text-slate-400">
        <svg class="h-4 w-4" viewBox="0 0 20 20" fill="none">
          <path d="M6 8l4 4 4-4"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round" />
        </svg>
      </span>
    </button>

    <div
      class="absolute z-30 mt-1 max-h-60 w-full overflow-auto rounded-xl border border-slate-200 bg-white text-sm shadow-lg hidden"
      role="listbox"
      data-language-swap-target="sourceMenu"
    >
      <% Language::LANGUAGE_CODE_TO_NAME_MAP.sort_by { |_c, n| n }.each do |code, name| %>
        <button
          type="button"
          role="option"
          aria-selected="<%= code == source_language.code %>"
          class="flex w-full items-center justify-between px-3 py-2 text-left hover:bg-slate-50 cursor-pointer <%= 'bg-slate-50' if code == source_language.code %>"
          data-action="click->language-swap#chooseSource"
          data-code="<%= code %>"
          data-name="<%= name %>"
        >
          <span class="truncate" dir="auto"><%= name %></span>
          <span class="text-slate-400 <%= code == source_language.code ? '' : 'hidden' %>" data-role="check">✓</span>
        </button>
      <% end %>
    </div>
  </div>

  <!-- SWAP BUTTON -->
  <div class="order-3 sm:order-2 sm:self-end">
    <button
      type="button"
      title="Swap languages"
      class="inline-flex w-full items-center justify-center gap-1 rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs text-slate-600 shadow-sm
             hover:border-slate-300 hover:bg-slate-50 hover:text-slate-800 cursor-pointer
             focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/40 focus-visible:ring-offset-2
             sm:h-9 sm:w-9 sm:gap-0 sm:rounded-full sm:px-0 sm:text-sm"
      data-action="language-swap#swap"
    >
      <span class="sm:hidden">Swap</span>
      <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none">
        <path
          d="M7 7h11M7 7l3-3M7 7l3 3M17 17H6M17 17l-3-3M17 17l-3 3"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>
  </div>

  <!-- TARGET DROPDOWN -->
  <div class="relative order-2 sm:order-3 sm:flex-1">
    <label class="mb-1 block text-xs font-medium uppercase tracking-wide text-slate-700">
      To
    </label>

    <button
      type="button"
      aria-haspopup="listbox"
      aria-expanded="false"
      class="flex w-full items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-2 text-left text-sm shadow-sm text-slate-900
             hover:border-slate-300 focus:outline-none focus:ring-1 focus:ring-sky-500/20 focus:border-sky-500 cursor-pointer"
      data-language-swap-target="targetLabel"
      data-action="click->language-swap#toggleTargetMenu"
    >
      <span class="truncate" dir="auto"><%= target_language.name %></span>
      <span class="ml-2 text-slate-400">
        <svg class="h-4 w-4" viewBox="0 0 20 20" fill="none">
          <path d="M6 8l4 4 4-4"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round" />
        </svg>
      </span>
    </button>

    <div
      class="absolute z-30 mt-1 max-h-60 w-full overflow-auto rounded-xl border border-slate-200 bg-white text-sm shadow-lg hidden"
      role="listbox"
      data-language-swap-target="targetMenu"
    >
      <% Language::LANGUAGE_CODE_TO_NAME_MAP.sort_by { |_c, n| n }.each do |code, name| %>
        <button
          type="button"
          role="option"
          aria-selected="<%= code == target_language.code %>"
          class="flex w-full items-center justify-between px-3 py-2 text-left hover:bg-slate-50 cursor-pointer <%= 'bg-slate-50' if code == target_language.code %>"
          data-action="click->language-swap#chooseTarget"
          data-code="<%= code %>"
          data-name="<%= name %>"
        >
          <span class="truncate" dir="auto"><%= name %></span>
          <span class="text-slate-400 <%= code == target_language.code ? '' : 'hidden' %>" data-role="check">✓</span>
        </button>
      <% end %>
    </div>
  </div>

</div>
