<div class="mx-auto w-full max-w-3xl">

  <div class="mb-6 sm:mb-8">
    <h1 class="text-xl font-semibold tracking-tight text-slate-900 sm:text-2xl">
      Translate sayings
    </h1>
    <p class="mt-2 text-sm text-slate-600 sm:text-base">
      Choose your languages, type a saying, and see the equivalent saying in your target language.
    </p>
  </div>

  <div class="rounded-2xl border border-slate-200 bg-white/95 p-4 shadow-sm sm:p-6">
    <%= form_with \
          url: translations_path,
          method: :get,
          class: "space-y-5" do %>

      <%= render "shared/language_selector",
            source_language: @source_language,
            target_language: @target_language,
            source_field: :source_language,
            target_field: :target_language %>

      <div class="relative"
           data-controller="autocomplete"
           data-autocomplete-submit-on-select-value="true"
           data-autocomplete-source-language-value="<%= @source_language.code %>"
           data-autocomplete-url-value="<%= autocomplete_sayings_path %>"
           data-autocomplete-language-changed-event-value="ts:source-language-changed">

        <label class="mb-1 block text-xs font-medium uppercase tracking-wide text-slate-700">
          Saying
        </label>

        <input
          type="text"
          id="translation_query"
          name="q"
          value="<%= @query %>"
          autocomplete="off"
          required
          minlength="3"
          maxlength="200"
          placeholder="Type a saying in <%= @source_language.name %>…"
          dir="auto"
          role="combobox"
          aria-autocomplete="list"
          aria-expanded="false"
          aria-controls="translation_suggestions"
          class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[16px] sm:text-sm text-slate-900 shadow-sm
                 placeholder:text-slate-400 focus:border-sky-500 focus:bg-white focus:outline-none focus:ring-1 focus:ring-sky-500/20"
          data-autocomplete-target="input"
          data-action="input->autocomplete#search keydown->autocomplete#handleKeydown"
        />

        <ul
          id="translation_suggestions"
          aria-label="Suggestions"
          class="
            absolute z-30 mt-1 w-full
            rounded-xl border border-slate-200 bg-white
            shadow-lg ring-1 ring-black/5
            text-sm text-slate-900
            overflow-hidden
            dark:bg-slate-800 dark:border-slate-700 dark:text-slate-100
            max-h-64 overflow-y-auto
          "
          data-autocomplete-target="list"
          role="listbox"
          hidden
        ></ul>
      </div>

      <div class="flex w-full items-center justify-end gap-3 pt-1">
        <button
          type="submit"
          data-turbo-submits-with="Translate"
          class="inline-flex items-center gap-1.5 rounded-full bg-[rgb(26,115,232)] px-4 py-2 text-sm font-medium text-white shadow-sm
                 hover:brightness-90 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900/20
                 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:bg-slate-400
                 disabled:text-white disabled:shadow-none"
        >
          Translate
        </button>
      </div>

    <% end %>
  </div>

  <% if @source_saying.present? %>
    <section class="mt-8 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm sm:p-5" aria-live="polite">
      <div class="flex flex-wrap items-baseline justify-between gap-x-3 gap-y-1">
        <h2 class="min-w-0 text-sm font-semibold text-slate-800">
          Equivalent sayings in <%= @target_language.name %>
        </h2>
        <p class="text-[11px] text-slate-500">
          <%= @source_language.name %> → <%= @target_language.name %>
        </p>
      </div>

      <% if @equivalent_sayings.any? %>
        <ul class="mt-3 space-y-1.5 text-sm leading-relaxed text-slate-900">
          <% @equivalent_sayings.each do |saying| %>
            <li class="rounded-lg bg-slate-50 px-3 py-1.5 wrap-break-word" dir="auto">
              <%= saying.text %>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="mt-3 text-sm text-slate-600">
          No equivalent sayings found.
        </p>
      <% end %>
    </section>

  <% elsif @query.present? %>
    <section aria-live="polite">
      <div class="mt-8 rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800 shadow-sm wrap-break-word">
        No saying found matching “<%= @query %>”.
      </div>
    </section>
  <% end %>

</div>
